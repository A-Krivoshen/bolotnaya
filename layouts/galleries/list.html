{{ define "main" }}
<main class="container" style="max-width:1100px;margin:0 auto;padding:24px;">
  <h1>{{ .Title }}</h1>
  {{ if not .Pages }}
    <p>Пока нет альбомов.</p>
  {{ else }}
  <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;">
    {{ range .Pages }}
      {{/* Берём картинки из текущей версии, а если пусто — из перевода (RU/EN) с тем же именем файла */}}
      {{ $p := . }}
      {{ $images := $p.Params.images }}
      {{ if not $images }}
        {{ range $p.Translations }}
          {{ if .Params.images }}
            {{ $images = .Params.images }}
          {{ end }}
        {{ end }}
      {{ end }}

      {{ $cover := "" }}
      {{ with index $images 0 }}
        {{ $src := .src }}
        {{ if not (hasPrefix $src "/") }}{{ $src = print "/images/galleries/" $src }}{{ end }}
        {{ $cover = $src }}
      {{ end }}

      <a href="{{ $p.RelPermalink }}" style="display:block;border:1px solid #e5e7eb;border-radius:14px;overflow:hidden;text-decoration:none;">
        {{ if $cover }}
          <div style="aspect-ratio:4/3;background:#f6f7f9">
            <img src="{{ $cover }}" alt="{{ $p.Title }}" loading="lazy" style="width:100%;height:100%;object-fit:cover">
          </div>
        {{ else }}
          <div style="aspect-ratio:4/3;display:flex;align-items:center;justify-content:center;background:#f6f7f9;color:#666;">Нет превью</div>
        {{ end }}
        <div style="padding:12px">
          <div style="font-weight:700">{{ $p.Title }}</div>
          {{ with $p.Params.description }}<div style="opacity:.7;font-size:.95rem;margin-top:4px;">{{ . }}</div>{{ end }}
          <div style="opacity:.6;font-size:.85rem;margin-top:8px;">{{ len $images }} фото</div>
        </div>
      </a>
    {{ end }}
  </div>
  {{ end }}
</main>
{{ end }}
