{{ define "main" }}
<main class="container py-6">
  <h1>{{ .Title }}</h1>
  {{ if .Content }}<div class="content">{{ .Content }}</div>{{ end }}

  <style>
    /* Responsive grid (2 on desktop, 3 on wide screens) */
    .gallery-grid{display:grid;grid-template-columns:1fr;gap:24px;margin:24px 0}
    @media(min-width:768px){.gallery-grid{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:1200px){.gallery-grid{grid-template-columns:repeat(3,1fr)}}

    /* Card uses PaperMod CSS variables to match dark/light themes */
    .gallery-card{
      background:var(--entry, #fff);
      color:var(--content, #111);
      border:1px solid var(--border, rgba(0,0,0,.08));
      border-radius:12px;
      overflow:hidden;
      transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    }
    .gallery-card:hover{
      transform:translateY(-2px);
      box-shadow:0 10px 28px rgba(15,25,40,.15);
      border-color:var(--border, rgba(0,0,0,.15));
    }
    .gallery-card a{display:block;text-decoration:none;color:inherit}
    .gallery-card img{width:100%;height:320px;object-fit:cover;display:block}
    .gallery-meta{padding:14px}
    .gallery-title{margin:0 0 6px 0;font-weight:700;font-size:1.05rem;line-height:1.25;color:var(--content, #111)}
    .gallery-count{margin:0;font-size:.9rem;color:var(--secondary, #6b7280)}
    .gallery-desc{margin:.5rem 0 0 0;font-size:.95rem;color:var(--secondary, #6b7280)}
  </style>

  {{ $pages := .Pages }}
  {{ if gt (len $pages) 0 }}
    <ul class="gallery-grid">
      {{ range $p := $pages }}
        {{/* Collect images from this page or its translations; keep it safe */}}
        {{- $images := slice -}}
        {{- with $p.Params.images -}}
          {{- $images = . -}}
        {{- else -}}
          {{- with $p.Translations -}}
            {{- range . -}}
              {{- if .Params.images -}}
                {{- $images = .Params.images -}}
              {{- end -}}
            {{- end -}}
          {{- end -}}
        {{- end -}}
        {{ if not $images }}{{ $images = slice }}{{ end }}
        {{ $cover := index $images 0 }}

        <li class="gallery-card">
          <a href="{{ $p.RelPermalink }}">
            {{ with $cover }}
              <img src="{{ .src }}" alt="{{ .alt | default "" }}">
            {{ end }}
            <div class="gallery-meta">
              <h2 class="gallery-title">{{ $p.Title }}</h2>
              <p class="gallery-count">{{ len $images }} фото</p>
              {{ with $p.Params.description }}
                <p class="gallery-desc">{{ . }}</p>
              {{ end }}
            </div>
          </a>
        </li>
      {{ end }}
    </ul>
  {{ else }}
    <p class="text-muted">Пока нет альбомов.</p>
  {{ end }}
</main>
{{ end }}
