
{{ define "main" }}
<article class="container history-page">
  <header>
    <h1>{{ .Title }}</h1>
    {{ with .Params.summary }}<p class="muted">{{ . }}</p>{{ end }}
  </header>

  {{ with .Content }}<section class="prose">{{ . }}</section>{{ end }}

  {{ $photos := slice }}
  {{ if .Params.photos }}        {{ $photos = .Params.photos }}
  {{ else if .Params.images }}   {{ $photos = .Params.images }}
  {{ end }}

  {{ if and (eq (len $photos) 0) .Params.gallery_slug }}
    {{ $slug := .Params.gallery_slug }}
    {{ $g := $.Site.GetPage (printf "galleries/%s" $slug) }}
    {{ if not $g }}
      {{ range $.Sites }}
        {{ if not $g }}
          {{ $maybe := .GetPage (printf "galleries/%s" $slug) }}
          {{ if $maybe }}{{ $g = $maybe }}{{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{ with $g }}
      {{ if .Params.photos }}      {{ $photos = .Params.photos }}
      {{ else if .Params.images }} {{ $photos = .Params.images }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ if gt (len $photos) 0 }}
  <link rel="stylesheet" href="/css/gallery-grid.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
  <section class="gallery-grid">
    {{ $group := printf "hist-%s" .File.BaseFileName | default "hist" }}
    {{ range $photos }}
      {{ $src := .src | default .url | default .image | default . }}
      {{ $thumb := .thumb | default $src }}
      {{ $cap := .title | default .caption }}
      <a class="gallery-item glightbox" href="{{ $src }}" data-gallery="{{ $group }}" {{ with $cap }}data-title="{{ . }}"{{ end }}>
        {{ partial "responsive-thumb.html" (dict "Page" $ "src" $src "thumb" $thumb "alt" $cap) }}
      </a>
    {{ end }}
  </section>
  <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded',function(){
      if (typeof GLightbox==='undefined') return;
      GLightbox({ selector: '.glightbox', touchNavigation: true, loop: true });
    });
  </script>
  {{ else }}
    <p class="muted">Нет фотографий для галереи.</p>
  {{ end }}
</article>
{{ end }}
