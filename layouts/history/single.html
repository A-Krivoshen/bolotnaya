{{ define "main" }}
<article class="container history-page">
  <header>
    <h1>{{ .Title }}</h1>
    {{ with .Params.summary }}<p class="muted">{{ . }}</p>{{ end }}
  </header>

  {{ with .Content }}
  <section class="history-intro prose">
    {{ . }}
  </section>
  {{ end }}

  {{/* Build photos list safely */}}
  {{ $photos := slice }}
  {{/* 1) take from page if present */}}
  {{ if .Params.photos }}
    {{ $photos = .Params.photos }}
  {{ else if .Params.images }}
    {{ $photos = .Params.images }}
  {{ end }}

  {{/* 2) fallback by gallery_slug: search in current site then other languages */}}
  {{ if and (eq (len $photos) 0) .Params.gallery_slug }}
    {{ $slug := .Params.gallery_slug }}
    {{ $g := $.Site.GetPage (printf "galleries/%s" $slug) }}
    {{ if not $g }}
      {{ range $.Sites }}
        {{ if not $g }}
          {{ $maybe := .GetPage (printf "galleries/%s" $slug) }}
          {{ if $maybe }}{{ $g = $maybe }}{{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{ with $g }}
      {{ if .Params.photos }}
        {{ $photos = .Params.photos }}
      {{ else if .Params.images }}
        {{ $photos = .Params.images }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ if gt (len $photos) 0 }}
  <section class="history-gallery grid">
    {{ range $photos }}
      {{ $src := .src | default .url | default .image | default . }}
      {{ $thumb := .thumb | default $src }}
      {{ $caption := .title | default .caption }}
      <a class="history-card" href="{{ $src }}" target="_blank" rel="noopener">
        <img loading="lazy" src="{{ $thumb }}" alt="{{ $caption }}">
        {{ with $caption }}<div class="cap">{{ . }}</div>{{ end }}
      </a>
    {{ end }}
  </section>
  {{ else }}
    <p class="muted">Нет фотографий для галереи.</p>
  {{ end }}
</article>
{{ end }}
