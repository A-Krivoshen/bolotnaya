{{/* Collect streams from front matter with backward compatibility */}}
{{- $streams := slice -}}
{{- if .Params.streams -}}
  {{- $streams = .Params.streams -}}
{{- else -}}
  {{- $s1 := dict "id" "cam1" "title" (default "Камера 1" .Params.camera1_title) "url" .Params.stream_url -}}
  {{- $s2 := dict "id" "cam2" "title" (default "Камера 2" .Params.camera2_title) "url" .Params.stream2_url -}}
  {{- if $s1.url -}}{{ $streams = $streams | append $s1 }}{{- end -}}
  {{- if $s2.url -}}{{ $streams = $streams | append $s2 }}{{- end -}}
{{- end -}}

<link rel="stylesheet" href="/css/camera-tabs.css" />

<div class="tabs" role="tablist" aria-label="Переключение камер">
  {{- range $i, $s := $streams -}}
    <button class="tab-btn" role="tab" aria-selected="{{ if eq $i 0 }}true{{ else }}false{{ end }}" data-key="{{ $s.id }}">{{ default (printf "Камера %d" (add $i 1)) $s.title }}</button>
  {{- end -}}
</div>

<div class="player-wrap">
  <video id="hls-video" controls playsinline muted></video>
  <div class="player-title" id="player-title">Онлайн трансляция</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
  window.__STREAMS__ = [
    {{- range $i, $s := $streams -}}
      {{- if gt $i 0 }},{{ end -}}
      {"id":"{{ $s.id }}","title":{{ printf "%q" (default (printf "Камера %d" (add $i 1)) $s.title) }},"url":{{ printf "%q" $s.url }}}
    {{- end -}}
  ];
</script>
<script src="/js/hls-tabs-init.js"></script>